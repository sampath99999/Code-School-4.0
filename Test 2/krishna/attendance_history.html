<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Attendance History</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="user_dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="attendance_history.html">Attendance History</a>
                    </li>
                </ul>
                <button class="btn btn-outline-light" id="logout">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Attendance History</h5>
                <div class="d-flex gap-2">
                    <input type="date" class="form-control" id="startDate">
                    <input type="date" class="form-control" id="endDate">
                    <button class="btn btn-primary" id="filterBtn">Filter</button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Clock In</th>
                                <th>Clock Out</th>
                                <th>Status</th>
                                <th>Hours Worked</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceHistoryBody">
                         
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            
            const token = sessionStorage.getItem('token');
            const role = sessionStorage.getItem('role');
            
            if (!token || role !== 'employee') {
                window.location.href = 'index.html';
                return;
            }

            
            const today = new Date();
            const thirtyDaysAgo = new Date(today);
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            $('#startDate').val(thirtyDaysAgo.toISOString().split('T')[0]);
            $('#endDate').val(today.toISOString().split('T')[0]);

            
            function fetchAttendanceHistory() {
                const startDate = $('#startDate').val();
                const endDate = $('#endDate').val();

                $.ajax({
                    url: 'api/get_attendance_history.php',
                    method: 'GET',
                    headers: {
                        'Authorization': token
                    },
                    data: {
                        start_date: startDate,
                        end_date: endDate
                    },
                    success: function(response) {
                        if (response.success) {
                            const history = response.data;
                            let html = '';
                            
                            if (history.length === 0) {
                                html = '<tr><td colspan="5" class="text-center">No attendance records found</td></tr>';
                            } else {
                                history.forEach(record => {
                                    html += `
                                        <tr>
                                            <td>${record.date}</td>
                                            <td>${record.clock_in}</td>
                                            <td>${record.clock_out}</td>
                                            <td>${record.status}</td>
                                            <td>${record.hours_worked}</td>
                                        </tr>
                                    `;
                                });
                            }
                            
                            $('#attendanceHistoryBody').html(html);
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: response.message || 'Failed to fetch attendance history'
                            });
                        }
                    },
                    error: function() {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to fetch attendance history'
                        });
                    }
                });
            }

           
            $('#filterBtn').click(function() {
                fetchAttendanceHistory();
            });

           
            $('#logout').click(function() {
                $.ajax({
                    url: 'api/logout.php',
                    method: 'POST',
                    headers: {
                        'Authorization': token
                    },
                    success: function() {
                        sessionStorage.clear();
                        window.location.href = 'index.html';
                    },
                    error: function() {
                        sessionStorage.clear();
                        window.location.href = 'index.html';
                    }
                });
            });

            
            fetchAttendanceHistory();
        });
    </script>
</body>
</html> 