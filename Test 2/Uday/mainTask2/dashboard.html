<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guest Acess Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <button
          class="btn"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasWithBothOptions"
          aria-controls="offcanvasWithBothOptions"
        >
          <span class="navbar-toggler-icon bg-dark"></span>
        </button>
        <a class="navbar-brand ms-3" href="#">My Home</a>
      </div>
    </nav>

    <div
      class="offcanvas offcanvas-start bg-dark text-white"
      data-bs-scroll="true"
      tabindex="-1"
      id="offcanvasWithBothOptions"
      aria-labelledby="offcanvasWithBothOptionsLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">
          Guest Access
        </h5>
        <button
          type="button"
          class="btn-close bg-light"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <div>
          <a
            href="#"
            class="nav-link text-white mb-2 approval-requests"
            data-file="approvalRequests.html"
            >Approval Requests</a
          >
          <a
            href="#"
            class="nav-link text-white mb-2 new-approval"
            data-file="newApproval.html"
            >New Approval</a
          >
          <a
            href="#"
            class="nav-link text-white mb-2"
            data-file="approvalLogs.html"
            >Approval Logs</a
          >
          <a href="#" class="btn btn-danger logout mt-2">Logout</a>
        </div>
      </div>
    </div>

    <div class="container mt-4 main-content">
      <div id="home-section">
        <div class="container mt-4">
          <p>Welcome ðŸ‘‹</p>
        </div>
      </div>

      <div id="pageLoads" style="display: none"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./js/login.js"></script>

    <script>
      $(document).ready(function () {
        const role = localStorage.getItem("role");
        if (role == "FlatOwner") {
          $(".new-approval").hide();
        } else {
          $(".new-approval").show();
          $(".approval-requests").hide();
        }
        $(".nav-link").on("click", function (e) {
          e.preventDefault();
          let file = $(this).data("file");
          if (file) {
            $("#home-section").hide();
            $("#pageLoads").show().load(file);
            localStorage.setItem("lastPage", file);
          }
        });

        $("#home").click(function (e) {
          e.preventDefault();
          $("#dynamic-content").hide();
          $("#pageLoads").show();
          localStorage.removeItem("lastPage");
        });

        const lastPage = localStorage.getItem("lastPage");
        if (lastPage) {
          $("#home-section").hide();
          $("#pageLoads").show().load(lastPage);
        } else {
          $("#pageLoads").hide();
          $("#home-section").show();
        }
        $(".logout").click(() => {
          window.location.href = "index.html";
          localStorage.removeItem("lastPage");
          localStorage.removeItem("token");
          localStorage.removeItem("role");
        });
        window.addEventListener("pageshow", function () {
          let token = localStorage.getItem("token");
          if (!token) {
            window.location.href = "index.html";
          }
        });
      });
    </script>
  </body>
</html>
