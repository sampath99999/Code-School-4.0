<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Update User</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <div
      class="container-fluid d-flex justify-content-center align-items-center vh-100 flex-column card"
    >
      <div class="border px-3 py-5 shadow rounded">
        <h3 class="text-center">Update User</h3>
        <form id="updateForm" class="px-3 py-3 needs-validation">
          <div class="mb-3">
            <label for="userId" class="form-label">User ID</label>
            <input
              type="number"
              class="form-control"
              id="userId"
              placeholder="Enter User ID"
            />
            <div class="invalid-feedback">Please enter a valid User ID.</div>
          </div>

          <div class="mb-3">
            <label for="lastName" class="form-label">New Last Name</label>
            <input
              type="text"
              class="form-control"
              id="lastName"
              placeholder="Enter New Last Name"
            />
            <div class="invalid-feedback">
              Last name is required (Min: 3, Max: 25 characters).
            </div>
          </div>

          <div class="d-flex justify-content-center">
            <button type="submit" class="btn btn-primary">Update</button>
          </div>
        </form>
      </div>

      <div
        id="contentDiv"
        class="container card p-3 shadow mt-4 text-center w-100 alert alert-secondary"
        style="max-width: 410px"
      >
        <h5>Response:</h5>
        <p id="content" class=""></p>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        function validateFields() {
          let userId = $("#userId").val().trim();
          let lastName = $("#lastName").val().trim();
          let isValid = true;

          if (!userId || userId <= 0) {
            $("#userId").addClass("is-invalid").removeClass("is-valid");
            isValid = false;
          } else {
            $("#userId").removeClass("is-invalid").addClass("is-valid");
          }

          if (lastName.length < 3 || lastName.length > 25) {
            $("#lastName").addClass("is-invalid").removeClass("is-valid");
            isValid = false;
          } else {
            $("#lastName").removeClass("is-invalid").addClass("is-valid");
          }

          return isValid;
        }

        $("#userId, #lastName").on("input", function () {
          validateFields();
        });

        $("#updateForm").on("submit", function (event) {
          event.preventDefault();
          if (!validateFields()) return;

          let userId = $("#userId").val().trim();
          let lastName = $("#lastName").val().trim();

          Swal.fire({
            title: "Are you sure?",
            text: `You are about to update User ID ${userId} with last name "${lastName}".`,
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, update it!",
          }).then((result) => {
            if (result.isConfirmed) {
              $.ajax({
                url: `https://dummyjson.com/users/${userId}`,
                method: "PUT",
                contentType: "application/json",
                data: JSON.stringify({ lastName }),
                success: function (response) {
                  Swal.fire({
                    title: "Updated!",
                    text: `User ${response.firstName} now has last name "${response.lastName}".`,
                    icon: "success",
                  });

                  $("#content").html(`
                            <strong>ID:</strong> ${response.id} <br>
                            <strong>First Name:</strong> ${response.firstName} <br>
                            <strong>Last Name:</strong> ${response.lastName} <br>
                            <strong>Gender:</strong> ${response.gender} <br>
                            `);

                  $("#updateForm")[0].reset();
                  $("#userId, #lastName").removeClass("is-valid is-invalid");

                  $("#contentDiv").addClass("alert-success");
                  $("#contentDiv").removeClass("alert-danger");
                },
                error: function () {
                  Swal.fire({
                    title: "Error!",
                    text: "User update failed. Try again.",
                    icon: "error",
                  });

                  $("#contentDiv").addClass("alert-danger");
                  $("#contentDiv").removeClass("alert-success");

                  $("#content").text("Error: User Not Found");
                },
              });
            }
          });
        });
      });
    </script>
  </body>
</html>
