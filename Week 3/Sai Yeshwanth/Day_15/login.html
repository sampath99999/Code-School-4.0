<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div
      class="card container-fluid d-flex justify-content-center align-items-center vh-100 flex-column"
    >
      <div
        class="border shadow px-4 py-5 rounded bg-white"
        style="max-width: 350px"
      >
        <h3 class="text-center mb-3">Login</h3>
        <div id="contentDiv" class="alert d-none" role="alert">
          <span id="content"></span>
        </div>
        <form id="loginForm">
          <div class="mb-3">
            <label for="userName" class="form-label">Username</label>
            <input type="text" class="form-control" id="userName" />
          </div>
          <div class="mb-3">
            <label for="passWord" class="form-label">Password</label>
            <input type="password" class="form-control" id="passWord" />
          </div>
          <div class="d-flex justify-content-center">
            <button type="submit" id="submitBtn" class="btn btn-primary w-100">
              <span id="btnText">Submit</span>
              <span
                id="spinner"
                class="spinner-border spinner-border-sm d-none"
                role="status"
                aria-hidden="true"
              ></span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>

    <script>
      localStorage.removeItem("authToken");

      function getInputValues() {
        return {
          username: $("#userName").val(),
          password: $("#passWord").val(),
        };
      }

      function validateData(data) {
        if (!data.username || !data.password) {
          throw new Error("Fill all the fields");
        }
      }

      $("#loginForm").submit(function (event) {
        event.preventDefault();

        try {
          const data = getInputValues();
          validateData(data);

          $("#submitBtn").prop("disabled", true);
          $("#btnText").text("");
          $("#spinner").removeClass("d-none");

          $.ajax({
            url: "https://dummyjson.com/auth/login",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            expiresInMins: 1,
            credentials: "include",
            success: function (response) {
              if (response.accessToken) {
                localStorage.setItem("authToken", response.accessToken);
                window.location.href = "./main.html";
              } else {
                showError("Invalid credentials");
              }
            },
            error: function () {
              showError("Error: User Not Found");
            },
          });
        } catch (error) {
          showError(error.message);
        }
      });

      function showError(message) {
        $("#contentDiv")
          .removeClass("d-none alert-success")
          .addClass("alert-danger");
        $("#content").text(message);
        resetButton();
      }

      function resetButton() {
        $("#submitBtn").prop("disabled", false);
        $("#btnText").text("Submit");
        $("#spinner").addClass("d-none");
      }
    </script>
  </body>
</html>
