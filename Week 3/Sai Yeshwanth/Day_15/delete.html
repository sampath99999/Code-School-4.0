<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Delete User</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      .form-container {
        max-width: 400px;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <div
      class="container-fluid d-flex justify-content-center align-items-center vh-100 flex-column card"
    >
      <div class="border px-4 py-5 shadow rounded form-container">
        <h3 class="text-center mb-4">Delete User</h3>
        <form id="deleteForm" class="px-3 py-3 needs-validation">
          <div class="mb-3">
            <label for="userId" class="form-label">User ID</label>
            <input
              type="number"
              class="form-control"
              id="userId"
              placeholder="Enter User ID"
              required
            />
            <div class="invalid-feedback">Please enter a valid User ID</div>
          </div>

          <div class="d-flex justify-content-center">
            <button type="submit" class="btn btn-danger w-50">
              Delete User
            </button>
          </div>
        </form>
      </div>

      <div
        id="contentDiv"
        class="container card p-3 shadow mt-4 text-center w-100 alert alert-secondary"
        style="max-width: 400px"
      >
        <h5>Response:</h5>
        <p id="content" class=""></p>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        function validate() {
          let userId = $("#userId").val().trim();
          let isValid = true;

          if (!userId || userId <= 0) {
            $("#userId").addClass("is-invalid").removeClass("is-valid");
            isValid = false;
          } else {
            $("#userId").removeClass("is-invalid").addClass("is-valid");
          }

          return isValid;
        }

        $("#userId").on("input", function () {
          validate();
        });

        $("#deleteForm").on("submit", function (event) {
          event.preventDefault();

          let userId = $("#userId").val().trim();

          Swal.fire({
            title: "Are you sure?",
            text: `You are about to delete user with ID ${userId}. This action cannot be undone!`,
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Yes, delete it!",
          }).then((result) => {
            if (result.isConfirmed) {
              $.ajax({
                url: `https://dummyjson.com/users/${userId}`,
                method: "DELETE",
                success: function (response) {
                  Swal.fire({
                    title: "Deleted!",
                    text: `User ${response.firstName} ${response.lastName} has been deleted.`,
                    icon: "success",
                  });

                  $("#content").html(`
                                    <strong>ID:</strong> ${response.id} <br>
                                    <strong>Name:</strong> ${
                                      response.firstName
                                    } ${response.lastName} <br>
                                    <strong>Maiden Name:</strong> ${
                                      response.maidenName || "N/A"
                                    } <br>
                                    <strong>Age:</strong> ${response.age} <br>
                                    <strong>Gender:</strong> ${
                                      response.gender
                                    } <br>
                                    <strong>Status:</strong> ${
                                      response.isDeleted ? "Deleted" : "Active"
                                    } <br>
                                    <strong>Deleted On:</strong> ${
                                      response.deletedOn || "N/A"
                                    } <br>
                                `);

                  $("#deleteForm")[0].reset();
                  $("#userId").removeClass("is-valid");

                  $("#contentDiv").addClass("alert-success");
                  $("#contentDiv").removeClass("alert-danger");
                },
                error: function () {
                  Swal.fire({
                    title: "Error!",
                    text: "User not found or unable to delete.",
                    icon: "error",
                  });

                  $("#contentDiv").addClass("alert-danger");
                  $("#contentDiv").removeClass("alert-success");
                  $("#content").text("Error: User Not Found");
                },
              });
            }
          });
        });
      });
    </script>
  </body>
</html>
